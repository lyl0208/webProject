<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myweb.repair.dao.RepairMapper">
    <resultMap id="repairMap" type="com.myweb.repair.model.Repair">
        <result column="repair_order_number" property="repairOrderNumber" jdbcType="VARCHAR"/>
        <result column="IMEI" property="IMEI" jdbcType="VARCHAR"/>
        <result column="maintenance_project" property="maintenanceProject" jdbcType="VARCHAR"/>
        <result column="amount_complained" property="amountComplained" jdbcType="DECIMAL"/>
    </resultMap>

    <resultMap id="phoneRepairDtoMap" type="com.myweb.repair.model.PhoneRepairDto">
        <result column="IMEI" property="IMEI" jdbcType="VARCHAR"/>
        <result column="state" property="state" jdbcType="INTEGER"/>
        <result column="degree" property="degree" jdbcType="VARCHAR"/>
        <result column="repair_order_number" property="repairOrderNumber" jdbcType="VARCHAR"/>
        <result column="damaged_part" property="damagedPart" jdbcType="VARCHAR"/>
        <result column="maintenance_project" property="maintenanceProject" jdbcType="VARCHAR"/>
        <result column="amount_complained" property="amountComplained" jdbcType="VARCHAR"/>
    </resultMap>


    <select id="listPhoneRepairDto" resultMap="phoneRepairDtoMap" parameterType="com.myweb.repair.model.RepairArgs">
        SELECT
          p.IMEI,
          p.state,
          p.degree,
          p.damaged_part,
          r.repair_order_number,
          r.maintenance_project,
          r.amount_complained
        FROM
          phone_info AS p
        LEFT JOIN repair AS r ON p.IMEI = r.IMEI
        <where>
            <trim prefixOverrides="and">
                <if test="state != null"> and p.state = #{state}</if>
                <if test="repairOrderNumber != null and repairOrderNumber != ''"> and r.repair_order_number = #{repairOrderNumber}</if>
            </trim>
        </where>
    </select>


    <select id="countByOrderNumber" resultType="java.lang.Integer">
        SELECT
          count(1)
        from
          repair
        where
          repair_order_number = #{orderNumber}
    </select>

    <insert id="save">
        INSERT INTO
          repair
        (
          repair_order_number,
          IMEI,
          maintenance_project,
          amount_complained
        )
        VALUES
        (
          #{repairOrderNumber},
          #{IMEI},
          #{maintenanceProject},
          #{amountComplained}
        )
    </insert>


</mapper>