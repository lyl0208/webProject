<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>销售单打印</title>
</head>
<body>
<table border="1" cellspacing="0"  style="width: 100%" id="ticketTable">
    <tr>
        <td style="width: 33%">
            销售单号
        </td>
        <td id="serialNumber"colspan="5">
        </td>
    </tr>
    <tr>
        <td style="width: 33%">
            销售日期
        </td>
        <td id="saleDate" colspan="5">
        </td>
    </tr>
    <tr>
        <td style="width: 33%">
            经办人
        </td>
        <td id="operatorName" colspan="5">
        </td>
    </tr>
    <tr>
        <td style="width: 33%">
            数量
        </td>
        <td id="number" colspan="5">
        </td>
    </tr>
    <tr id="sellLogBefore">
        <td>手机IMEI</td>
        <td>品牌</td>
        <td>型号</td>
        <td>颜色</td>
        <td>内存</td>
        <td>价格</td>
    </tr>
    <tr>
        <td rowspan="4">结算方式</td>
        <td colspan="3" rowspan="4">
            <select id="calcType" onchange="changeCalcType()">
                <option value="xianjin">现金</option>
                <option>支付宝</option>
                <option>微信</option>
                <option>银行卡</option>
            </select>
        </td>
    </tr>
    <tr>
        <td>合计</td>
        <td id="totalPrice" style="width: 15%"></td>
    </tr>
    <tr>
        <td>实收</td>
        <td style="width: 15%"><input type="text" placeholder="请输入实收金额"></td>
    </tr>
    <tr>
        <td>找零</td>
        <td style="width: 15%"><input type="text" id="zhaoling" placeholder="请输入找零金额(仅限现金)"></td>
    </tr>
</table>

<br/><br/>
<input style="float: right;" id="printBtn" type="button" onclick="doPrint()" value="打印">


</body>
</html>
<script type="text/javascript" src="/static/libs/jquery/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
    $(function () {

       var serialNumber = getArgsFromHref(window.location.href,'serialNumber');
       var operatorName = getArgsFromHref(window.location.href,'operatorName');
       var saleDate = getArgsFromHref(window.location.href,'saleDate');
       var number = getArgsFromHref(window.location.href,'number');
       var totalPrice = getArgsFromHref(window.location.href,'totalPrice');

       $('#serialNumber').html(serialNumber);
       $('#operatorName').html(decodeURI(operatorName));
       $('#saleDate').html(timestampToTime(saleDate));
       $('#number').html(number);
       $('#totalPrice').html(totalPrice);

       $.post({
           url:"/api/sell/getSellLog",
           data:{token:getToken(),serialNumber:serialNumber},
           success:function (data) {
               for (var i = 0;i < data.length; i++) {
                   var sellLog = data[i];
                   $('#sellLogBefore').after("<tr>" +
                       "        <td>"+sellLog.imei+"</td>" +
                       "        <td>"+sellLog.brandName+"</td>" +
                       "        <td>"+sellLog.modelName+"</td>" +
                       "        <td>"+sellLog.colorName+"</td>" +
                       "        <td>"+sellLog.memoryName+"</td>" +
                       "        <td>"+sellLog.transactionPrice+"</td>" +
                       "    </tr>")
               }

           }
       })

    });
    
    function changeCalcType() {
        if ($('#calcType').val() === 'xianjin') {
            document.getElementById("zhaoling").readOnly = false;
        } else {
            document.getElementById("zhaoling").readOnly = true;
            document.getElementById("zhaoling").value = "";
        }
    }

    //获取当前token
    function getToken() {
        return localStorage.getItem("token");
    }


    function getArgsFromHref(sHref,sArgName) {

        var args = sHref.split('?');
        var retval = '';

        if (args[0] === sHref)
        {
            //参数为空
            return retval;
        }

        var str = args[1];
        args = str.split("&");
        for (var i = 0; i < args.length; i ++) {
            str = args[i];
            var arg = str.split("=");
            if (arg.length <= 1) {
                continue;
            }
            if (arg[0] === sArgName) {
                retval = arg[1];
            }
        }
        return retval;

    }

    function timestampToTime(timestamp) {
        var date = new Date(parseInt(timestamp));
        var Y = date.getFullYear() + '-';
        var M = date.getMonth() + 1
        M = M < 10?'0'+M+'-':M+'-';
        var D = date.getDate() + ' ';
        var h = date.getHours() + ':';
        var m = date.getMinutes() + ':';
        var s = date.getSeconds();
        return Y+M+D+h+m+s;
    }

    function doPrint() {
        $('#printBtn').hide();
        window.print();
    }

</script>

